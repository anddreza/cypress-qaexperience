"use strict";var bcrypt=require("bcrypt"),Joi=require("joi"),express=require("express"),validator=require("express-joi-validation").createValidator({passError:!0}),app=express();app.use(express.json());var _require=require("./db"),deleteUser=_require.deleteUser,insertUser=_require.insertUser,findToken=_require.findToken,userSchema=Joi.object({name:Joi.string().required(),email:Joi.string().email().required(),password:Joi.string().required(),is_shaver:Joi.boolean().required()});app.get("/welcome",function(e,r){r.json({message:"Ol√°"})}),app.get("/token/:email",function(r,s){var t,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.params.email,e.next=3,regeneratorRuntime.awrap(findToken(t));case 3:if(a=e.sent,s.status(200).end(a),a){e.next=7;break}return e.abrupt("return",s.status(404).end());case 7:s.status(200).json(a);case 8:case"end":return e.stop()}})}),app.delete("/user/:email",function(r,s){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.params.email,e.next=3,regeneratorRuntime.awrap(deleteUser(t));case 3:s.status(204).end();case 4:case"end":return e.stop()}})}),app.post("/user",validator.body(userSchema),function(r,s){var t,a,n,i,o,u,p,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.body,a=t.name,n=t.email,i=t.password,o=t.is_shaver,e.next=3,regeneratorRuntime.awrap(bcrypt.hash(i,8));case 3:return u=e.sent,p={name:a,email:n,password:u,is_shaver:o},console.log(p),e.prev=6,e.next=9,regeneratorRuntime.awrap(deleteUser(p.email));case 9:return e.next=11,regeneratorRuntime.awrap(insertUser(p));case 11:c=e.sent,s.status(201).json({user_id:c}),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(6),s.status(500).json({error:"Ocorreu um erro.",stack:e.t0});case 18:case"end":return e.stop()}},null,null,[[6,15]])}),app.use(function(e,r,s,t){e&&e.error&&e.error.isJoi?s.status(400).json({type:e.type,message:e.error.toString()}):t(e)}),app.listen(5e3);
//# sourceMappingURL=app.min.js.map
